{"id":"mvp-0kz","title":"Remove '--content' option from set override command","description":"Remove the '--content' option from the set override command in fleetroll CLI. This option should be removed from the command interface and any related code.","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-26T23:55:54.165281Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T03:32:42.101510Z","closed_at":"2026-01-27T03:32:42.101510Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-0x9","title":"Standardize exit handling via exceptions","description":"Commands mix paradigms for error handling:\n- cmd_host_set calls sys.exit(1) on failure\n- cmd_host_audit returns normally, relies on caller\n- main() catches exceptions and translates to exit codes\n\nThis inconsistency makes testing harder and behavior unpredictable.\n\nSolution: Commands should raise exceptions (UserError or FleetRollError); main() in cli.py handles all exit code translation. This improves testability and consistency.","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:55.315520Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T13:00:57.000313Z","closed_at":"2026-01-29T13:00:57.000283Z","close_reason":"Standardized exit handling across all commands. Created CommandFailure exception, updated main() to handle it, replaced 14 sys.exit() calls in 5 command files, updated 4 tests. Fixed unrelated test_monitor_render test. All 281 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-0x9","depends_on_id":"mvp-vc5","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"},{"issue_id":"mvp-0x9","depends_on_id":"mvp-vsw","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-10y","title":"Refactor test_color_palette.py to use display code","description":"Refactor tools/dev/test_color_palette.py to use the actual color palette logic from fleetroll/commands/monitor/display.py instead of hardcoding ANSI codes and palette definitions. The test file should import and reuse the palette definitions (basic colors, extended 256 colors, fg/bg combos) and color mapping logic from the display module to ensure consistency and reduce duplication.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-30T05:26:57.217927Z","created_by":"aerickson","updated_at":"2026-02-04T04:48:49.284982Z","closed_at":"2026-02-04T04:48:49.284943Z","close_reason":"Completed refactoring","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-13x","title":"Update audit parser for new fields","description":"Modify fleetroll/audit.py process_audit_result() to parse all PP_* fields from new JSON state file and add to observed dict. Handle backward compatibility: prefer new PP_STATE_TS over old PP_LAST_RUN_EPOCH. Add observed fields: puppet_state_ts, puppet_git_sha, puppet_git_repo, puppet_git_branch, puppet_git_dirty, puppet_override_sha_applied, puppet_vault_sha_applied, puppet_role, puppet_exit_code, puppet_duration_s.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T21:41:19.948801Z","created_by":"aerickson","updated_at":"2026-01-30T06:41:35.197301Z","closed_at":"2026-01-30T06:41:35.197263Z","close_reason":"Completed: Added parsing for all 10 new PP_* fields and comprehensive test coverage","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-13x","depends_on_id":"mvp-2us","type":"blocks","created_at":"2026-01-29T21:41:32.261515Z","created_by":"aerickson"},{"issue_id":"mvp-13x","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:19.949547Z","created_by":"aerickson"}]}
{"id":"mvp-14e","title":"Create reference run-puppet.sh scripts","description":"Create clean reference implementations in reference/ directory for both Linux and macOS. Base on examples/ scripts, integrate state writing function, document integration points for deployment teams.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T21:41:16.302096Z","created_by":"aerickson","updated_at":"2026-01-29T22:49:53.929152Z","closed_at":"2026-01-29T22:49:53.929112Z","close_reason":"Completed: Created reference run-puppet.sh scripts for Linux and macOS with state tracking integration","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-14e","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:16.302931Z","created_by":"aerickson"},{"issue_id":"mvp-14e","depends_on_id":"mvp-uvz","type":"blocks","created_at":"2026-01-29T21:41:32.207711Z","created_by":"aerickson"}]}
{"id":"mvp-194","title":"Collect/store/display tc quarantine reason","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-05T22:01:02.901489Z","created_by":"aerickson","updated_at":"2026-02-05T22:01:02.901489Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1cl","title":"Create 'gather' command family (gather, gather-host, gather-tc)","description":"Create unified 'gather' command structure to better organize host data collection.\n\n## Current State\n- `audit` - SSH-based host introspection (writes to host_observations.jsonl)\n- `tc-fetch` - TaskCluster API queries (reads observations, writes to tc_workers.jsonl)\n\n## Proposed Structure\nRename to hyphenated command family (flat CLI structure):\n- `gather` - wrapper that runs both gather-host + gather-tc\n- `gather-host` - SSH-based host introspection (current `audit`)\n- `gather-tc` - TaskCluster API queries (current `tc-fetch`)\n\n## Rationale\n- Creates clear naming hierarchy showing relationship between commands\n- 'gather' is more intuitive than 'audit' (which implies compliance)\n- Keeps commands separate for flexibility (different data sources, timing patterns)\n- Wrapper provides convenience for common workflow\n\n## Implementation Plan\n1. Rename `audit` → `gather-host` (keep `audit` as deprecated alias)\n2. Rename `tc-fetch` → `gather-tc` (keep `tc-fetch` as deprecated alias)\n3. Create `gather` wrapper that runs both in sequence\n4. Handle shared CLI options (quiet, verbose, timeout, etc.)\n5. Update tests and documentation\n\n## Backwards Compatibility\n- Keep old command names as aliases with deprecation warnings\n- Remove aliases in next major version","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-29T09:12:46.988484Z","created_by":"aerickson","updated_at":"2026-01-30T09:39:42.072431Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1g1","title":"Refactor tc_fetch.py to extract testable helper functions","description":"Extract testable helper functions from cmd_tc_fetch() to improve testability and coverage.\n\nCurrent state:\n- cmd_tc_fetch() is a 220-line function with complex orchestration\n- Contains untestable I/O mixed with business logic\n- Coverage stuck at ~18% in tc_fetch.py\n\nProposed refactoring:\n1. Extract map_hosts_to_roles() - Pure logic to map hosts to roles from audit data\n2. Extract map_roles_to_worker_types() - Logic to map roles to TaskCluster worker types\n3. Extract match_workers_to_hosts() - Worker matching logic\n4. Keep cmd_tc_fetch() as thin orchestration layer calling these helpers\n\nBenefits:\n- Each helper function can be unit tested without mocking\n- Separates business logic from I/O\n- Improves maintainability and readability\n- Could achieve ~40% coverage in tc_fetch.py\n\nSee testing plan in conversation for details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T02:14:26.177471Z","created_by":"aerickson","updated_at":"2026-01-29T12:40:52.495243Z","closed_at":"2026-01-29T12:40:52.495203Z","close_reason":"Extracted 3 testable helpers: build_role_to_hosts_mapping, map_roles_to_worker_types, match_workers_to_hosts. Added 15 comprehensive tests. All 43 tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1gi","title":"Add checksum to backup filenames (vault and overrides)","description":"Add checksum (SHA256 prefix) to backup filenames for both override and vault files.\n\nCurrent: ronin_settings.bak.20260126T120000Z\nProposed: ronin_settings.bak.20260126T120000Z.abc123def456\n\nBenefits:\n- Shows when identical content was redeployed (multiple timestamps, same hash)\n- Provides integrity verification\n- Easy to identify content without opening file\n\nApply to both:\n- remote_set_script() for override files\n- remote_set_vault_script() for vault files\n\nCalculate SHA256 before backup, use first 12 chars of hash in filename.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-29T06:53:58.089021Z","created_by":"aerickson","updated_at":"2026-01-30T09:39:31.167110Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1gq","title":"DATA column shows failed attempt age as recent data","description":"In host-monitor, when a connection fails and there's no previous successful data, the DATA column shows the age of the failed attempt (e.g., '4m/-') instead of '-/-'. This is misleading because it appears as if we received data 4 minutes ago, when in fact we only attempted a connection that failed.\n\nThe bug is in fleetroll/commands/monitor/data.py:465-466 in build_row_values(). When ok=False and there's no last_ok fallback, it calculates audit_str from the failed record's timestamp.\n\nFix: When ok=False and no last_ok, the audit portion of DATA should be '-' not the age of the failed attempt.\n\nTest with: uv run fleetroll host-monitor host-lists/all_moonshots.list --once","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-30T05:29:09.379239Z","created_by":"aerickson","updated_at":"2026-01-30T05:29:09.379239Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1hm","title":"Remote host: vault backup deduplication and capping","description":"Apply same backup file capping to vault.yaml files as we did for override files in mvp-fx7:\n- Skip backup if content is identical (preserve mtime)\n- Keep only 30 most recent backups\n- Automatic cleanup on set/unset operations\n- Update remote_set_vault_script() in ssh.py\n\nSame logic as override backup cleanup, just for vault files.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-29T06:49:12.122691Z","created_by":"aerickson","updated_at":"2026-01-29T07:10:30.888408Z","closed_at":"2026-01-29T07:10:30.888370Z","close_reason":"Already complete: vault files use remote_set_script() which was updated in mvp-fx7. Vault backups now have content deduplication (skip if identical), preserve mtime, keep 30 most recent, and automatic cleanup. All tests passing.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1k8","title":"Migrate host and TC data to SQLite","description":"Migrate host_observations and tc_workers storage from JSONL to SQLite with hybrid schema (indexed columns + JSON blob). See closed mvp-7rz for full design rationale.\n\nScope:\n- Create SQLite storage layer\n- Migrate host_observations reads/writes\n- Migrate tc_workers reads/writes\n- Add JSONL-to-SQLite migration tool\n- audit.jsonl, overrides/, vault_yamls/ stay as-is","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-05T21:37:04.125537Z","created_by":"aerickson","updated_at":"2026-02-05T21:37:04.125537Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1k8.1","title":"Create SQLite storage layer and schema","description":"Create the SQLite database module with:\n- Database initialization (create tables, enable WAL mode)\n- host_observations table: (host TEXT, ts TEXT, ok INTEGER, data JSON, PRIMARY KEY (host, ts))\n- tc_workers table: (host TEXT, ts TEXT, type TEXT, data JSON, PRIMARY KEY (host, ts))\n- Helper functions: insert record, get latest per host, get latest N per host\n- Connection management (single file at ~/.fleetroll/fleetroll.db)","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T21:37:09.814361Z","created_by":"aerickson","updated_at":"2026-02-05T21:37:09.814361Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-1k8.1","depends_on_id":"mvp-1k8","type":"parent-child","created_at":"2026-02-05T21:37:09.814361Z","created_by":"aerickson"}]}
{"id":"mvp-1k8.2","title":"Migrate host_observations reads/writes to SQLite","description":"Update host-audit command and monitor to read/write host_observations from SQLite instead of JSONL. Replace:\n- append_jsonl() calls with SQLite inserts\n- load_latest_records() full-file scan with indexed query\n- AuditLogTailer with SQLite polling (or keep tailer as a thin wrapper)\n- load_latest_vault_checksums() with indexed query\n- get_host_roles_bulk() with indexed query","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T21:37:16.035300Z","created_by":"aerickson","updated_at":"2026-02-05T21:37:30.109879Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-1k8.2","depends_on_id":"mvp-1k8","type":"parent-child","created_at":"2026-02-05T21:37:16.035300Z","created_by":"aerickson"},{"issue_id":"mvp-1k8.2","depends_on_id":"mvp-1k8.1","type":"blocks","created_at":"2026-02-05T21:37:30.109851Z","created_by":"aerickson"}]}
{"id":"mvp-1k8.3","title":"Migrate tc_workers reads/writes to SQLite","description":"Update tc-fetch command and monitor to read/write tc_workers from SQLite instead of JSONL. Replace:\n- append_jsonl() calls with SQLite inserts\n- load_tc_worker_data() full-file scan with indexed query","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T21:37:19.526070Z","created_by":"aerickson","updated_at":"2026-02-05T21:37:30.134464Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-1k8.3","depends_on_id":"mvp-1k8","type":"parent-child","created_at":"2026-02-05T21:37:19.526070Z","created_by":"aerickson"},{"issue_id":"mvp-1k8.3","depends_on_id":"mvp-1k8.1","type":"blocks","created_at":"2026-02-05T21:37:30.134434Z","created_by":"aerickson"}]}
{"id":"mvp-1k8.4","title":"Add JSONL-to-SQLite migration command","description":"Create a one-time migration command (e.g. fleetroll migrate-to-sqlite) that:\n- Reads existing host_observations.jsonl and taskcluster_workers.jsonl\n- Bulk inserts records into SQLite\n- Keeps original JSONL files as backups (rename with .bak suffix)\n- Idempotent (safe to run multiple times)","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-05T21:37:24.396146Z","created_by":"aerickson","updated_at":"2026-02-05T21:37:30.160289Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-1k8.4","depends_on_id":"mvp-1k8","type":"parent-child","created_at":"2026-02-05T21:37:24.396146Z","created_by":"aerickson"},{"issue_id":"mvp-1k8.4","depends_on_id":"mvp-1k8.1","type":"blocks","created_at":"2026-02-05T21:37:30.160266Z","created_by":"aerickson"}]}
{"id":"mvp-1ki","title":"host-monitor: show override/vault names in ovr_sha and vlt_sha columns","description":"Display human-readable override/vault filenames in host-monitor columns (ovr_sha, vlt_sha) when filenames are resolved from checksums. Depends on mvp-1o9 which provides the config filename lookup functionality.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-03T19:58:53.578444Z","created_by":"aerickson","updated_at":"2026-02-03T23:18:25.516708Z","closed_at":"2026-02-03T23:18:25.516674Z","close_reason":"Redundant with mvp-1o9. Original plan was to modify existing SHA columns, but new plan adds separate ovr_info/vlt_info columns instead, which accomplishes the same goal.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1o9","title":"Add ovr_info/vlt_info columns to display human-readable override/vault info","description":"Add new columns `ovr_info` and `vlt_info` to display human-readable names for overrides and vaults alongside existing SHA columns.\n\n**Override info (ovr_info)**:\n- Parse override file content from `~/.fleetroll/overrides/<sha>`\n- Extract PUPPET_REPO (for user) and PUPPET_BRANCH (for branch)\n- Display as \"user/branch\" (e.g., \"aerickson/feature-branch\")\n- Fallback to \"-\" if parsing fails\n\n**Vault info (vlt_info)**:\n- Check for symlinks in `~/.fleetroll/vault_yamls/` pointing to SHA-named files\n- Display symlink name (e.g., \"prod-db-creds\")\n- Fallback to \"-\" if no symlink exists\n\n**Performance**:\n- Read files at startup, build cache of {sha256 → info} mappings\n- Only look up new SHAs that appear during refresh\n- Start with main thread implementation, optimize with background thread if startup becomes slow (>200ms)\n\n**Implementation notes**:\n- Keep existing `sha` and `vlt_sha` columns unchanged\n- Add new columns to monitor display and formatting\n- Cache results to avoid re-reading files on every refresh","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-30T09:37:34.424390Z","created_by":"aerickson","updated_at":"2026-02-04T02:39:59.282859Z","closed_at":"2026-02-04T02:39:59.282825Z","close_reason":"Completed - ovr_info/vlt_info columns added to monitor display","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1ok","title":"host-monitor: add statistics panel ('S' key)","description":"Add statistics panel to host-monitor interactive mode. Press 'S' (capital S) to show overlay with aggregate stats:\n- Number of unique roles\n- Number of unique override SHAs\n- Number of unique vault.yaml SHAs\n- Average uptime across hosts\n- Applied counts (Y/N/-)\n- Healthy counts (Y/N/-)\n- Hosts with stale data\n- Any other useful fleet-wide metrics\n\nSimilar to '?' help popup but showing computed statistics about the current fleet state.","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-29T12:27:38.913311Z","created_by":"aerickson","updated_at":"2026-02-04T04:40:39.987817Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1ri","title":"Check host update status against GitHub master and override branches","description":"Pull GitHub information about override branches and master to determine if the host is up to date (has applied the latest commit). This should compare the host's current state against the latest commits on master and any override branches to indicate whether updates are available or if the host is current.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-02-06T23:19:22.050036Z","created_by":"aerickson","updated_at":"2026-02-06T23:29:10.110046Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-1sg","title":"Add fleetroll token to backup filenames","description":"Add a fleetroll-specific token to backup filenames to avoid accidentally cleaning up other users' backup files.\n\nCurrent: ronin_settings.bak.20260129T070000Z\nProposed: ronin_settings.fleetroll-backup.20260129T070000Z\n\nOr alternative: ronin_settings.bak-fleetroll.20260129T070000Z\n\nBenefits:\n- More specific identifier prevents accidental cleanup of non-fleetroll backups\n- Safe coexistence with other backup tools\n- Clear ownership/provenance of backup files\n\nUpdate:\n- remote_set_script() - change backup naming pattern\n- remote_unset_script() - change backup naming pattern  \n- Cleanup logic - match new pattern (*.fleetroll-backup.*)\n\nApplies to both override and vault backup files.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-29T07:13:39.474239Z","created_by":"aerickson","updated_at":"2026-01-29T07:13:39.474239Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-27v","title":"Decompose cmd_host_audit_batch function","description":"At 100+ lines, cmd_host_audit_batch (commands/audit.py) handles too many concerns:\n- Threading setup\n- Retry logic\n- Progress bar management\n- Result aggregation\n\nThis makes it hard to test and understand.\n\nSuggested decomposition:\n```python\ndef audit_hosts(hosts, args) -> List[AuditResult]:\n    \"\"\"Pure orchestration - testable without SSH.\"\"\"\n\ndef with_progress(iterable, show: bool):\n    \"\"\"Progress bar wrapper.\"\"\"\n\ndef aggregate_results(results) -> Summary:\n    \"\"\"Result aggregation - separately testable.\"\"\"\n```","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:55.527944Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T13:08:36.786832Z","closed_at":"2026-01-29T13:08:36.786797Z","close_reason":"Decomposed cmd_host_audit_batch from 99 lines to 33 lines. Extracted aggregate_audit_summary() and execute_audits_parallel() helper functions. Added 6 comprehensive tests for aggregation logic. All 287 tests pass.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-27v","depends_on_id":"mvp-vc5","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-29n","title":"host-audit doesn't log SSH auth failures","description":"host-audit doesn't write records for SSH auth failures (\"Permission denied\"). \n\n**Root cause:** In audit.py:288-293, rc==255 is treated as a \"connection error\" which triggers retry logic. After max retries, the result is returned (lines 337-348) WITHOUT calling process_audit_result(), so NO record is written to host_observations.jsonl.\n\n**The bug:** \"Permission denied\" means SSH is UP (host reachable, port open, daemon responded) but authentication failed. This should be logged immediately, not retried.\n\n**Policy (user-defined):**\n- SSH port responds (auth fails, protocol errors) → Log immediately  \n- Can't connect (timeout, refused, DNS failure) → Retry, don't log unless persistent\n\n**Current behavior:**\n- \"Permission denied\" has rc==255 → treated as connection error → retried → never logged\n- Example: ms-080 has been scanned many times but has 0 records in observations log\n\n**Fix:** In audit.py:288-293, remove \"rc == 255\" from is_connection_error check. Add specific pattern matching:\n- Connection errors (retry): \"Connection refused\", \"Connection timed out\", \"Could not resolve hostname\"\n- Auth/protocol errors (log): \"Permission denied\", etc. (anything else with rc != 0)\n\nThis ensures reachable hosts with auth issues are logged (so monitor shows actual state) while unreachable hosts don't spam the log.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-30T05:43:04.753283Z","created_by":"aerickson","updated_at":"2026-01-30T05:43:04.753283Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-2hf","title":"Shorten hostname field in host-monitor mode","description":"Display short hostnames (e.g., t-linux64-ms-016) instead of full FQDNs (e.g., t-linux64-ms-016.test.releng.mdc1.mozilla.com) in the HOST column of host-monitor mode","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T09:16:17.726265Z","created_by":"aerickson","updated_at":"2026-01-29T02:51:05.047843Z","closed_at":"2026-01-29T02:50:45.560928Z","close_reason":"already done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-2hf","depends_on_id":"mvp-5jc","type":"blocks","created_at":"2026-01-29T02:51:05.047814Z","created_by":"aerickson"}]}
{"id":"mvp-2ho","title":"Color TC_T_DUR by task completion status","description":"Add task state (completed/exception/failed) to TC_T_DUR field in host-monitor. Currently only shows duration, but TaskCluster API returns state field that we're not using. Need to: (1) Extract task_state from latestTask.run in tc_fetch.py, (2) Store in worker records, (3) Color TC_T_DUR column based on state: green=completed, yellow=exception, red=failed","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-06T23:02:06.311621Z","created_by":"aerickson","updated_at":"2026-02-06T23:12:21.238900Z","closed_at":"2026-02-06T23:12:21.238891Z","close_reason":"Completed: Added task state extraction, storage, and coloring to TC_T_DUR column","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-2iv","title":"Improve host-monitor confidence indicators for new functionality","description":"In host-monitor mode, use confidence indicators (YY vs Y) in APPLIED and HEALTH columns when using new functionality from mvp-3kp","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-29T22:03:57.352889Z","created_by":"aerickson","updated_at":"2026-02-04T02:50:30.015326Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-2iv","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T22:03:57.354492Z","created_by":"aerickson"},{"issue_id":"mvp-2iv","depends_on_id":"mvp-ahw","type":"blocks","created_at":"2026-02-04T02:50:30.015298Z","created_by":"aerickson"}]}
{"id":"mvp-2n5","title":"Add OS filtering and sorting to host-monitor interactive mode","description":"Add OS field to host audit data and enable filtering/sorting by OS in host-monitor interactive mode.\n\nCurrent state:\n- OS type is detected (uname -s) but not captured in audit data\n- Interactive mode supports sorting by host ('s' key) and role ('s' key toggle)\n- No ability to filter or sort by operating system\n\nProposed changes:\n1. Capture OS type in audit script and add to observed data (Linux/Darwin/etc)\n2. Add OS column to host-monitor display\n3. Extend sort_field to support 'os' option\n4. Add keyboard shortcut to cycle through sort options (host → role → os)\n5. Optional: Add filter mode to show only specific OS (e.g., 'f' key → filter menu)\n\nBenefits:\n- Easy identification of Linux vs macOS hosts in the fleet\n- Ability to focus on hosts of a specific OS during rollouts\n- Better fleet composition visibility\n- Useful for OS-specific testing and debugging\n\nImplementation notes:\n- Modify ssh.py audit script to output OS_TYPE\n- Update observed data parsing to include 'os' field\n- Extend get_host_sort_key() in monitor/data.py to handle 'os' sort\n- Update MonitorDisplay.handle_key() to cycle through sort fields\n- Consider adding OS to summary header or stats panel","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-29T12:52:26.065115Z","created_by":"aerickson","updated_at":"2026-02-04T04:41:03.986518Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-2o9","title":"Add backward compatibility for old puppet metrics format","description":"Tests were failing because the code only supported new PP_STATE_JSON format but not the old flat format with individual PP_* fields (PP_LAST_RUN_EPOCH, PP_SUCCESS, etc.). Added backward compatibility in fleetroll/audit.py to fall back to parsing old format fields when new JSON format is not present. This ensures support for Linux hosts without updated puppet metrics generation. All 293 tests now passing.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-30T07:52:53.718199Z","created_by":"aerickson","updated_at":"2026-01-30T07:53:06.957746Z","closed_at":"2026-01-30T07:53:06.957706Z","close_reason":"Completed - backward compatibility implemented in fleetroll/audit.py","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-2od","title":"Humanize LAST_OK timestamp in host-monitor","description":"Convert the LAST_OK column in host-monitor from full timestamp to humanized relative time format for consistency with other time-based columns.\n\n## Current Behavior\n\nLAST_OK currently displays full ISO timestamps:\n- \"2026-01-27T04:25:30.123456Z\"\n- Takes up significant column width (64 chars max)\n- Harder to scan quickly\n\n## Proposed Behavior\n\nDisplay as relative time:\n- \"just now\" (< 1 minute)\n- \"5m ago\" (< 60 minutes)\n- \"2h ago\" (< 24 hours)\n- \"3d ago\" (< 7 days)\n- \"2w ago\" (>= 7 days)\n\n## Benefits\n\n- Easier to scan at a glance\n- Consistent with new TC columns (TC_LAST, TC_START, TC_RESV)\n- Reduces column width requirements\n- More intuitive for monitoring use case\n\n## Implementation\n\n1. Create or reuse humanize_timestamp utility function\n2. Update build_row_values() to format ts field using humanization\n3. Update column width cap for ts column (can reduce from 64 to ~10)\n4. Ensure proper sorting still works (sort by raw timestamp, display humanized)\n\n## Note\n\nUPTIME column is already humanized (\"2d 5h\", \"45m\"). This change makes LAST_OK consistent with that pattern.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-27T05:50:48.087074Z","created_by":"aerickson","updated_at":"2026-01-27T07:42:45.579135Z","closed_at":"2026-01-27T07:42:45.579103Z","close_reason":"Implemented humanized timestamp for LAST_OK column. Changed from full ISO timestamps to relative time format (e.g., '5m ago', '2h ago'). Updated column width from 64 to 12 chars. All tests pass.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-2us","title":"Update collector to read new state file","description":"Modify fleetroll/ssh.py audit_script_body() to check for /etc/puppet/last_run_metadata.json, parse JSON fields using bash, output as key-value pairs, fall back to YAML if missing. Add fields: PP_STATE_TS, PP_GIT_SHA, PP_OVERRIDE_SHA_APPLIED, etc.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T21:41:18.201479Z","created_by":"aerickson","updated_at":"2026-01-30T06:16:42.637874Z","closed_at":"2026-01-30T06:16:42.637837Z","close_reason":"Completed: Updated audit_script_body() to read JSON state file with fallback to YAML","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-2us","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:18.202041Z","created_by":"aerickson"},{"issue_id":"mvp-2us","depends_on_id":"mvp-uvz","type":"blocks","created_at":"2026-01-29T21:41:32.236576Z","created_by":"aerickson"}]}
{"id":"mvp-2vw","title":"Display TaskCluster data in host-monitor","description":"Display TaskCluster worker data in the host-monitor interface by reading from taskcluster_workers.jsonl.\n\n## Prerequisites\n\n- tc-fetch command implemented (collects and stores TC data)\n- Horizontal scrolling implemented (to accommodate new columns)\n\n## New Columns to Add\n\n1. TC_QUAR: Quarantine status\n   - Display: \"Y\" if quarantined, \"-\" if not, empty if no data\n   - Sort by: quarantine status (quarantined first)\n\n2. TC_LAST: Last date active\n   - Display: Humanized relative time (\"2h ago\", \"5m ago\", \"3d ago\")\n   - Sort by: timestamp (most recent first)\n\n3. TC_START: Task started timestamp\n   - Display: Humanized relative time (\"45m ago\")\n   - Sort by: timestamp (most recent first)\n\n4. TC_RESV: Task resolved timestamp\n   - Display: Humanized relative time (\"40m ago\")\n   - Sort by: timestamp (most recent first)\n\n## Data Loading\n\n1. On monitor startup, read .fleetroll/taskcluster_workers.jsonl\n2. Build in-memory map: hostname → TC worker data\n3. For each host in display, look up TC data by stripping FQDN:\n   - t-linux64-ms-016.test.releng.mdc1.mozilla.com → t-linux64-ms-016\n4. Match against worker_id field in JSONL records (type=\"worker\")\n5. If multiple records exist for same host, use most recent by ts\n6. If no TC data: Display \"-\" in all TC columns\n\n## Timestamp Humanization\n\nUse relative time formatting:\n- < 1 minute: \"just now\"\n- < 60 minutes: \"5m ago\", \"45m ago\"\n- < 24 hours: \"2h ago\", \"12h ago\"\n- < 7 days: \"3d ago\", \"5d ago\"\n- >= 7 days: \"2w ago\", \"3mo ago\"\n\n## Column Placement\n\nAdd TC columns after existing columns:\nSTAT | ERR | HOST | ROLE | OVR_SHA | VLT_SHA | UPTIME | LAST_OK | TC_QUAR | TC_LAST | TC_START | TC_RESV\n\nWith horizontal scrolling, all columns remain accessible.\n\n## Color Coding\n\nConsider color coding for TC_QUAR:\n- Quarantined: Red/warning color (similar to error state)\n- Not quarantined: Normal color\n\n## Refresh Behavior\n\n- TC data is loaded once at monitor startup\n- Press 'r' to reload audit log AND TC data\n- Consider adding indicator showing age of TC data (when last fetched)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T05:50:23.712611Z","created_by":"aerickson","updated_at":"2026-01-27T07:04:31.566959Z","closed_at":"2026-01-27T07:04:31.566931Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-2vw","depends_on_id":"mvp-f46","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"},{"issue_id":"mvp-2vw","depends_on_id":"mvp-iea","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-2xt","title":"Add tests for new functionality","description":"Add unit tests for JSON state writing, JSON parsing in collector, audit parser new fields. Add integration test end-to-end with mock host data. Add backward compatibility test for old YAML data.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-29T21:41:23.644731Z","created_by":"aerickson","updated_at":"2026-01-29T21:41:23.645423Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-2xt","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:23.645403Z","created_by":"aerickson"}]}
{"id":"mvp-2y1","title":"Add color coding to command outputs","description":"Added color coding to improve readability of command dry-run outputs and monitor status line.\n\nChanges:\n- Monitor display: Show only filename (not full path) in source field to save horizontal space\n- set-override: Color headers (cyan), warnings (yellow), content delimiters (magenta)\n- unset-override: Color headers (cyan), warnings (yellow)\n- set-vault: Color headers (cyan), warnings (yellow), vault contents notice (magenta)\n\nAll commands now have consistent color scheme for better visual hierarchy in dry-run mode.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-30T08:21:07.108741Z","created_by":"aerickson","updated_at":"2026-01-30T08:21:23.648789Z","closed_at":"2026-01-30T08:21:23.648740Z","close_reason":"Completed color coding implementation for command outputs","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-2y8","title":"Integrate GitHub data for host version verification","description":"Integrate GitHub API to fetch master branch commit information. When no override is set for a host, use the GitHub API to determine the current commit on the master branch. This allows verification that hosts are running the expected version. Consider: API rate limits, caching strategy, fallback behavior when API unavailable, configuration for repo URL.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-05T01:31:39.808809Z","created_by":"aerickson","updated_at":"2026-02-05T01:31:39.808809Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-31n","title":"Extend monitor rendering test coverage","description":"The monitor module (fleetroll/commands/monitor.py) is 991 lines but has only 1 test in test_monitor_render.py. This is a critical coverage gap.\n\n## Areas needing tests\n- **Column dropping logic**: compute_columns_and_widths() drops columns when terminal is narrow\n- **Color mapping**: STATUS_COLORS, different states (ok, override, error, stale)\n- **Pagination**: Page up/down, scrolling behavior\n- **Edge cases**: Empty host list, all hosts failed, very long hostnames\n- **Truncation**: Text truncation with ellipsis\n- **Sorting**: Different sort modes (host, status, last_ok)\n- **Filtering**: Host filtering logic\n\n## Why P2\nMonitor is a primary user interface. Bugs here are highly visible. The complex curses logic is error-prone and currently untested. Refactoring (mvp-27v style) will be risky without tests.","status":"closed","priority":1,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:52:34.770689Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T04:05:52.138238Z","closed_at":"2026-01-27T04:05:52.138202Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-366","title":"Support data collection on OS X","description":"Add support for collecting host data on OS X systems. \n\nOS X uses different file paths than Linux for puppet configuration:\n- Override path: /opt/puppet_environments/ronin_settings (vs /etc/puppet/ronin_settings on Linux)\n- Vault path: /var/root/vault.yaml (vs /root/vault.yaml on Linux)\n- Role path: /etc/puppet_role (same as Linux)\n\nThese paths are already defined in constants.py as OSX_OVERRIDE_PATH, OSX_VAULT_PATH.\n\nImplementation should:\n1. Detect the operating system (Darwin vs Linux)\n2. Use the appropriate path constants from constants.py based on OS\n3. Ensure all data collection commands work correctly on OS X\n4. Test on actual OS X systems to verify paths and functionality","status":"closed","priority":1,"issue_type":"feature","assignee":"claude-sonnet-4-5","created_at":"2026-01-28T01:57:30.466955Z","created_by":"aerickson","updated_at":"2026-01-29T08:16:10.127651Z","closed_at":"2026-01-29T08:16:10.127615Z","close_reason":"OS X support implemented, all tests passing","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-36e","title":"Update documentation","description":"Update README with puppet state file section. Update docs/rollout-health-verification.md with new approach. Add comment in mvp-3kp epic explaining implementation.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-29T21:41:24.799787Z","created_by":"aerickson","updated_at":"2026-01-29T21:41:37.018444Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-36e","depends_on_id":"mvp-13x","type":"blocks","created_at":"2026-01-29T21:41:36.991787Z","created_by":"aerickson"},{"issue_id":"mvp-36e","depends_on_id":"mvp-14e","type":"blocks","created_at":"2026-01-29T21:41:36.940047Z","created_by":"aerickson"},{"issue_id":"mvp-36e","depends_on_id":"mvp-2us","type":"blocks","created_at":"2026-01-29T21:41:36.964799Z","created_by":"aerickson"},{"issue_id":"mvp-36e","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:24.800667Z","created_by":"aerickson"},{"issue_id":"mvp-36e","depends_on_id":"mvp-ahw","type":"blocks","created_at":"2026-01-29T21:41:37.018418Z","created_by":"aerickson"},{"issue_id":"mvp-36e","depends_on_id":"mvp-uvz","type":"blocks","created_at":"2026-01-29T21:41:36.912389Z","created_by":"aerickson"}]}
{"id":"mvp-379","title":"Colorize TC_LAST field in host-monitor","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T08:20:31.745079Z","created_by":"aerickson","updated_at":"2026-01-29T02:51:02.836659Z","closed_at":"2026-01-29T02:50:17.896590Z","close_reason":"seems to be colorized already","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-379","depends_on_id":"mvp-5jc","type":"blocks","created_at":"2026-01-29T02:51:02.836630Z","created_by":"aerickson"}]}
{"id":"mvp-38v","title":"AGENTS.md: mention to use prek vs pre-commit","description":"Update AGENTS.md to recommend using 'prek' instead of 'pre-commit' for running pre-commit hooks. This aligns with project tooling preferences and provides clearer guidance for agents.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-29T19:45:27.223762Z","created_by":"aerickson","updated_at":"2026-01-29T19:46:54.506883Z","closed_at":"2026-01-29T19:46:54.506845Z","close_reason":"Documentation already updated with prek usage recommendations","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-38w","title":"Fix status line overlap with two-line layout","description":"If upper hard status line overlaps, use two lines. Move right side content to line below.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-29T20:37:03.698108Z","created_by":"aerickson","updated_at":"2026-01-29T20:37:26.006257Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-3cu","title":"Add structured logging for debugging","description":"Beyond the audit file, add optional debug logging for troubleshooting:\n\nimport logging\nlogger = logging.getLogger(__name__)\n\nImplementation:\n- Add --debug / -d flag that sets logging level to DEBUG\n- Add --log-file option for writing logs to file\n- Log key operations: SSH commands (sanitized), retries, timing\n- Use structured format (JSON) for log entries when --json is set\n\nExample:\n  $ fleetroll host-audit myhost --debug\n  DEBUG: Building SSH options: ['-o', 'BatchMode=yes', ...]\n  DEBUG: Executing SSH to myhost (timeout=60s)\n  DEBUG: SSH completed in 1.23s (rc=0)\n  ...\n\nThis helps users diagnose connection issues, timeout problems, etc.","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:56.080010Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T23:03:55.454990Z","closed_at":"2026-01-16T23:03:55.454990Z","close_reason":"Added --debug/-d flag for debug logging. Logs SSH commands, timing, retries, and connection errors to stderr.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-3cu","depends_on_id":"mvp-fgd","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-3jw","title":"Windows support","description":"Add comprehensive Windows support to fleetroll. This includes: Windows-specific SSH implementations, terminal capability detection on Windows hosts, PowerShell/cmd.exe compatibility, Windows path handling, Windows service/process management, testing on Windows environments, and documentation for Windows deployment.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-05T01:55:26.856285Z","created_by":"aerickson","updated_at":"2026-02-05T01:55:26.856285Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-3kp","title":"Improved puppet run tracking","description":"## Problem\n\nCurrently, the host-monitor APPLIED and HEALTHY columns try to infer whether puppet has applied the current state by:\n1. Comparing puppet's last run time against override file mtime\n2. Tracking override removal times via unset records or audit transitions\n\nThis approach is fragile and requires complex heuristics. We can't reliably determine:\n- When an override was removed (if done before auditing started or manually)\n- Whether puppet actually applied the current configuration\n- What git SHA the host was converged at\n\n## Solution\n\nHave the puppet wrapper script write out a state file with the actual applied state. This gives us ground truth instead of inference.\n\n## Puppet State File\n\nLocation: `/var/lib/puppet/last_run.json` (or similar)\n\nFields to include:\n- `ts` - ISO timestamp when puppet ran\n- `success` - true/false\n- `exit_code` - actual exit code\n- `git_repo` - repository URL\n- `git_branch` - branch name  \n- `git_sha` - commit SHA that was applied\n- `override_sha` - SHA256 of override file applied (null if none)\n- `vault_sha` - SHA256 of vault file used (null if none)\n- `override_path` - path to override file\n- `role` - puppet role applied\n- `duration_s` - how long the run took\n\n## Benefits\n\n1. **APPLIED becomes simple:**\n   - Override present: Y if puppet.override_sha == current_override_sha and success\n   - Override absent: Y if puppet.override_sha == null and success\n\n2. **New columns possible:**\n   - PP_SHA - does puppet's git_sha match expected rollout SHA?\n   - OVR_MATCH - does puppet's override_sha match current file?\n\n3. **No heuristics needed:**\n   - Direct comparison of \"what puppet applied\" vs \"what's currently there\"\n   - No guessing about removal times or boot times\n\n## Implementation Steps\n\n1. Modify run-puppet.sh wrapper to write JSON state file after each run\n2. Update audit script to read and include puppet state in observed data\n3. Update host-monitor to use puppet state for APPLIED/HEALTHY logic\n4. Add new columns (PP_SHA, etc.) as needed\n\n## Related\n\nThis supersedes the complex removal-time tracking logic that was being developed.","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-28T08:26:39.745974Z","created_by":"aerickson","updated_at":"2026-02-03T23:31:11.957932Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-3ls","title":"host-monitor fails when audit log doesn't exist","description":"The host-monitor command fails with 'ERROR: Audit log not found: ~/.fleetroll/audit.jsonl' when the audit log doesn't exist. After splitting logs out, the audit log should no longer be required for host-monitor to function. Need to make audit log optional or remove the requirement entirely.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-29T08:06:18.385391Z","created_by":"aerickson","updated_at":"2026-01-29T08:37:14.961600Z","closed_at":"2026-01-29T08:37:14.961565Z","close_reason":"Fixed monitor to check for host_observations.jsonl instead of audit.jsonl","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-3v0","title":"Track and display last successful puppet run datetime","description":"See `docs/rollout-health-verification.md` for the full design including:\n- Data model (puppet_last_run_epoch, puppet_success)\n- New monitor column: PP_LAST (time since last successful puppet run, or FAIL)\n- Health assessment logic for verifying rollout completion","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-27T22:29:04.304287Z","created_by":"aerickson","updated_at":"2026-01-28T06:15:09.444872Z","closed_at":"2026-01-28T06:15:09.444837Z","close_reason":"Implemented puppet run tracking and rollout health columns (PP_LAST, APPLIED, HEALTHY)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-3vc","title":"Add support for rollouts","description":"Add support for orchestrating rollouts across hosts in phases.\n\n## Requirements\n- Track rollout configurations in files under configs/rollouts/\n- Each rollout specifies:\n  - Override to apply\n  - Optional vault.yml for secrets\n  - Host phases (groups of hosts to roll out sequentially)\n\n## Design considerations\n- How to define phases (percentage-based, explicit lists, queries)\n- Failure handling and rollback strategy\n- Progress tracking and reporting\n- Integration with existing override and vault mechanisms","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-30T08:33:00.177869Z","created_by":"aerickson","updated_at":"2026-01-30T08:33:00.177869Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-411","title":"Add notes feature for host tracking","description":"Add notes feature to track host-specific annotations. See docs/notes-feature.md for detailed design and implementation plan.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-29T01:41:58.136093Z","created_by":"aerickson","updated_at":"2026-02-05T21:38:13.993609Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-4er","title":"Move from sorting modes to views for flexible display control","description":"Refactor from sorting modes to views that can control multiple display settings (host, role, no_data, etc.) in an integrated way for better UX. Include an os-role view that sorts by OS, then hostname within each OS group.","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-29T23:20:32.837803Z","created_by":"aerickson","updated_at":"2026-02-04T04:41:19.483494Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-5jc","title":"Refactor MonitorDisplay.draw_screen method","description":"MonitorDisplay.draw_screen() in fleetroll/commands/monitor.py is 187 lines (lines 686-872). This violates single-responsibility and makes the code hard to maintain.\n\n## Current structure\nThe method handles:\n- Screen clearing and border drawing\n- Header rendering with status counts\n- Column header rendering\n- Host row rendering with colors\n- Footer/help text rendering\n- Scroll position management\n- Error state display\n\n## Suggested refactoring\nExtract helper methods:\n- draw_header() - Title bar and status summary\n- draw_column_headers() - Column labels\n- draw_host_rows() - Main table content\n- draw_footer() - Help text and key bindings\n- draw_error_state() - Error display\n\n## Why P3\nTechnical debt that doesn't affect functionality. Should be addressed before adding new monitor features (mvp-c29, mvp-hmg). Consider doing after test coverage is improved (reduces refactoring risk).","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:52:35.135656Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T03:33:06.086637Z","closed_at":"2026-01-29T03:33:06.086595Z","close_reason":"Refactored draw_screen method from 372 lines to 58 lines by extracting 8 focused methods with single responsibilities","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-5zx","title":"Prevent duplicate logging handlers","description":"setup_logging adds a new StreamHandler on every call, which can duplicate log lines in tests or repeated CLI invocations in-process. Guard against adding duplicate handlers or reset handlers before adding.","status":"closed","priority":3,"issue_type":"bug","owner":"aerickson@mozilla.com","created_at":"2026-01-21T00:38:48.554758Z","created_by":"Andrew Erickson","updated_at":"2026-01-21T06:04:03.559892Z","closed_at":"2026-01-21T06:04:03.559892Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-6h3","title":"Collect taskcluster worker success rate","description":"Fetch and collect taskcluster worker success rate data. This data will be used by the monitor display feature.","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:43:57.215282Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T05:49:05.346948Z","closed_at":"2026-01-27T05:49:05.346892Z","close_reason":"Superseded by new TaskCluster data collection approach (tc-fetch command)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-6rl","title":"Add CLI integration tests","description":"Currently only 2 tests in test_commands_audit.py exercise actual command execution. Most tests mock SSH, which misses integration issues.\n\n## Current gaps\n- No end-to-end tests of full CLI flow (argparse → command → output)\n- No tests verifying exit codes for different scenarios\n- No tests of --json output format correctness\n- No tests of error message formatting\n\n## Suggested approach\n1. Use Click's CliRunner for isolated CLI testing\n2. Mock at SSH boundary (not deeper) to test full command logic\n3. Test matrix:\n   - audit: single host, batch, --json, failures\n   - set: with content, from file, syntax error, dry-run\n   - unset: with backup, without backup, missing file\n   - monitor: basic startup (harder to test interactively)\n\n## Why P3\nUnit tests cover most logic. Integration tests are valuable but lower priority than fixing actual gaps. Good to have before major refactoring.","status":"open","priority":4,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:52:35.303085Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T09:30:40.861965Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-7et","title":"Reduce code duplication between single and batch audit","description":"cmd_host_audit_single (line 575) and cmd_host_audit_batch (line 486) share significant logic:\n- Both build SSH options the same way\n- Both call remote_audit_script with same parameters\n- Both process results similarly\n- Both format output (single vs table)\n\nRefactor so batch handles n=1 case, eliminating the separate single-host code path:\n\ndef cmd_host_audit(args):\n    hosts = [args.host] if not is_host_file(args.host) else parse_host_list(...)\n    \n    # Always use batch logic (works for 1 host too)\n    summary = cmd_host_audit_batch(hosts, args)\n    \n    # Format output based on count and args\n    if len(hosts) == 1 and not args.json:\n        format_single_host_output(summary['results'][0], args)\n    else:\n        format_batch_output(summary, args)\n\nThis reduces maintenance burden and ensures consistent behavior.","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:56.297019Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:55:03.783383Z","closed_at":"2026-01-16T22:55:03.783383Z","close_reason":"Unified single/batch audit paths. Single host now uses batch logic (gains retry support). Created format_single_host_output() for single-host display. Removed cmd_host_audit_single().","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-7et","depends_on_id":"mvp-fgd","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-7qf","title":"Use dataclasses for command options instead of argparse.Namespace","description":"argparse.Namespace loses all type information, making IDE support and static analysis ineffective.\n\nCreate typed dataclasses for each command's options:\n\n@dataclass\nclass AuditOptions:\n    host: str\n    override_path: str = DEFAULT_OVERRIDE_PATH\n    role_path: str = DEFAULT_ROLE_PATH\n    no_content: bool = False\n    store_content: bool = False\n    workers: int = 10\n    batch_timeout: int = 600\n    verbose: bool = False\n\n@dataclass  \nclass SetOptions:\n    host: str\n    override_path: str = DEFAULT_OVERRIDE_PATH\n    from_file: Optional[str] = None\n    content: Optional[str] = None\n    mode: str = \"0644\"\n    owner: str = \"root\"\n    group: str = \"root\"\n    ...\n\nBenefits: type checking, IDE autocomplete, self-documenting code.","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:55.003639Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:57:10.824437Z","closed_at":"2026-01-16T22:57:10.824437Z","close_reason":"Superseded by Click migration. argparse.Namespace replaced with simple Args class. Click provides type validation at CLI level. Typed dataclasses can be added later if strict mypy checking is desired.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-7qf","depends_on_id":"mvp-olh","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-7rz","title":"Evaluate storage format for tc and host data (consider SQLite)","description":"Migrate host_observations and tc_workers from JSONL to SQLite.\n\n## Decision\nSQLite with hybrid schema: a few indexed columns + JSON blob for the full record. This preserves JSONL-like flexibility (new fields = just add to dict) while gaining indexed queries and eliminating full-file scans.\n\n## Current Pain Points\n- Monitor does O(n) scan of 49MB/58K-line host_observations.jsonl to find latest per host\n- Same for tc_workers at 54MB/125K lines\n- Unbounded file growth with manual rotation only\n- No query capability beyond full scan\n\n## Design\n\n### Schema (host_observations)\n```sql\nCREATE TABLE host_observations (\n    host TEXT NOT NULL,\n    ts   TEXT NOT NULL,\n    ok   INTEGER,\n    data JSON NOT NULL,  -- full observation dict\n    PRIMARY KEY (host, ts)\n);\n```\n\n### Schema (tc_workers)\n```sql\nCREATE TABLE tc_workers (\n    host TEXT NOT NULL,\n    ts   TEXT NOT NULL,\n    type TEXT NOT NULL,  -- 'worker' or 'scan'\n    data JSON NOT NULL,\n    PRIMARY KEY (host, ts)\n);\n```\n\n### What stays the same\n- audit.jsonl — stays JSONL (append-only, rarely queried)\n- overrides/ and vault_yamls/ — stay as content-addressed files on disk\n\n### Schema evolution strategy\n- New fields: just add to the JSON dict (zero friction, same as JSONL today)\n- Need to query a new field often: promote to a column via ALTER TABLE ADD COLUMN (no migration framework)\n- json_extract() available for ad-hoc queries into the blob\n\n### Migration path\n- Read existing JSONL files, bulk insert into SQLite\n- Keep old JSONL files as backups\n- Use WAL mode for concurrent read performance\n\n### What this unlocks\n- O(log n) latest-record-per-host lookups via index\n- Retention policy (keep latest N records per host, prune old)\n- Ad-hoc queries (e.g. all hosts with failed puppet)\n- Foundation for statistics panel (mvp-1ok) and other features","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-04T06:15:57.365307Z","created_by":"aerickson","updated_at":"2026-02-05T21:36:57.840991Z","closed_at":"2026-02-05T21:36:57.840980Z","close_reason":"Evaluation complete. Decision: SQLite with hybrid schema (indexed columns + JSON blob). See description for full design.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-7ud","title":"Investigate audit log truncation threshold","description":"Investigate when the audit log should be truncated to prevent performance issues.\n\n## Analysis\n\nThe audit log is a JSONL file (append-only). Each record is ~500-1000 bytes containing timestamp, actor, action, host, SSH result, and observed state (role, override metadata, SHA256 hash).\n\n### Actual Growth Rates (Observed)\n- audit.jsonl: 94 MB in <1 week (~13 MB/day, ~4.7 GB/year)\n- taskcluster_workers.jsonl: 37 MB in <1 week (~5 MB/day, ~1.8 GB/year)\n- Much faster than initial estimates due to high operation frequency\n\n### Performance Thresholds\n- <100 MB: No concern\n- 100 MB - 1 GB: Fine for append-only writes, full scans get slower\n- 1 GB+: Should consider rotation/truncation\n- 10 GB+: Definitely needs attention\n\n## Implementation (2026-01-28)\n\n### Decisions Made\n1. **Split logs into three files:**\n   - `audit.jsonl` - Real user actions only (set/unset override, set vault) - low velocity\n   - `host_observations.jsonl` - Host state snapshots (host.audit) - high velocity\n   - `taskcluster_workers.jsonl` - TC worker scan data (unchanged)\n\n2. **Threshold: 100 MB** - Warn when any log file reaches 100 MB\n\n3. **Manual rotation only** - No auto-rotation (user might be mid-operation)\n   - Command: `fleetroll rotate-logs --confirm`\n   - Only rotates files >= 100 MB threshold\n   - Archives with timestamp: `logfile.jsonl.YYYYMMDD-HHMMSS`\n   - New files start empty (no backfill)\n\n4. **Warning in monitor** - Top header shows warning in yellow when logs exceed threshold\n   - Format: \"⚠ Large logs: obs=142M tc=156M (run 'fleetroll rotate-logs')\"\n\n### Rationale\n- Splitting logs separates high-velocity observations from critical audit events\n- 100 MB gives advance warning before performance degrades\n- Manual rotation gives user control over timing\n- No backfill keeps implementation simple and logs pure append-only\n\n### Backward Compatibility\n- Monitor reads from `host_observations.jsonl` if it exists, falls back to `audit.jsonl` for old data\n- Graceful migration - no manual intervention needed","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:31:47.267184Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T06:22:47.787889Z","closed_at":"2026-01-29T06:22:47.787857Z","close_reason":"Completed: Investigated log growth, implemented 3-way log split (audit/observations/TC), added 100 MB threshold with monitor warnings, and manual rotation command with --force flag. All tests passing.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-83l","title":"Replace die() with proper exception handling","description":"The die() function at line 146 calls sys.exit() directly, which:\n- Makes code hard to test\n- Prevents cleanup in calling code\n- Mixes error reporting with control flow\n\nReplace with a UserError exception class:\n\nclass UserError(FleetRollError):\n    \"\"\"Errors that should be shown to user without traceback.\"\"\"\n    pass\n\n# In command functions:\nraise UserError(\"Refusing to set override without --confirm\")\n\n# In main():\nexcept UserError as e:\n    print(f\"ERROR: {e}\", file=sys.stderr)\n    sys.exit(2)\n\nThis allows tests to catch exceptions and verify error conditions.","status":"closed","priority":1,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:55.217724Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:32:23.727570Z","closed_at":"2026-01-16T22:32:23.727570Z","close_reason":"Replaced die() with UserError exception class. Exceptions now handled in main() with proper exit codes.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-8vc","title":"Fix embedded shell script boolean in remote_audit_script","description":"Line 207 in remote_audit_script has a fragile pattern:\n\n    if { \"true\" if include_content else \"false\" }; then\n\nThis embeds a Python expression result directly into shell script text, which is confusing and error-prone.\n\nFix by assigning to a variable first:\n    include_cmd = \"true\" if include_content else \"false\"\n    # Then in script:\n    f\"if {include_cmd}; then\"\n\nThis makes the code clearer and less prone to syntax issues.","status":"closed","priority":1,"issue_type":"bug","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:54.795481Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:29:53.965214Z","closed_at":"2026-01-16T22:29:53.965214Z","close_reason":"Extracted inline Python ternary to named variable 'include_content_cmd' for clarity","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-9m0","title":"Add runtime summary for set/unset filelists","description":"When running set/unset with filelists, output a runtime summary at the end (e.g., counts and duration).","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-26T23:46:51.492804Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T00:15:42.195593Z","closed_at":"2026-01-27T00:15:42.195593Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-a7t","title":"Stop writing override content to audit log (store sha only)","description":"Remove --store-content CLI option. Always allow content display in output when fetched, but never persist override contents to audit.jsonl. Audit log should only include override_sha256 and (optionally) stored file path if we keep storing files. Update cli.py (option removal), commands/audit.py and audit.py to stop logging override_contents/override_contents_for_display into JSONL, and adjust tests.","status":"closed","priority":1,"issue_type":"bug","owner":"aerickson@mozilla.com","created_at":"2026-01-21T00:57:15.881342Z","created_by":"Andrew Erickson","updated_at":"2026-01-21T06:11:10.656979Z","closed_at":"2026-01-21T06:11:10.656979Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-agb","title":"Manage vault.yaml + show checksum like override","description":"Add host-set-vault command (single host or host list) with --from-file and --confirm. Store a local copy in ~/.fleetroll/vault_yamls/ like overrides; checksum method/format same as overrides. Push to /root/vault.yaml by default with --path override (e.g., macs). Remote file perms/owner/group should match: -rw-r----- 1 root root. Atomic write like overrides; create a backup (flag-controlled, default on). Display checksum label VLT_SHA after override SHA in audit/monitor; audit shows stored checksum only (no validation).","status":"closed","priority":2,"issue_type":"feature","owner":"aerickson@mozilla.com","created_at":"2026-01-27T01:12:28.225107Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T02:54:17.109365Z","closed_at":"2026-01-27T02:54:17.109365Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-ahw","title":"Update monitor to use new ground truth","description":"Modify monitor data.py and display.py to add new SHA-based APPLIED logic using puppet_override_sha_applied comparison while maintaining legacy timestamp heuristics as fallback for older puppet setups. Add PP_SHA column (7 char truncated git SHA). Update PP_LAST to use puppet_state_ts with fallback to old field. This dual-path approach enables mvp-2iv to show confidence indicators based on available metadata.","status":"closed","priority":1,"issue_type":"task","assignee":"claude-sonnet-4.5","created_at":"2026-01-29T21:41:22.308793Z","created_by":"aerickson","updated_at":"2026-02-06T23:42:35.424178Z","closed_at":"2026-02-06T23:42:35.424166Z","close_reason":"Completed. Implemented SHA-based APPLIED logic with timestamp fallback, updated PP_LAST to use puppet_state_ts, and added PP_SHA column.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-ahw","depends_on_id":"mvp-13x","type":"blocks","created_at":"2026-01-29T21:41:32.287730Z","created_by":"aerickson"},{"issue_id":"mvp-ahw","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:22.309358Z","created_by":"aerickson"}]}
{"id":"mvp-aw9","title":"Refactor curses monitor for maintainability","description":"Simplify the host-monitor curses implementation without switching libraries:\n\n1. **Extract draw_screen() to a class** - Currently a 190-line nested function with nonlocal state in monitor.py:704-892. Create a MonitorDisplay class to encapsulate:\n   - Screen state (offset, page_step, max_offset)\n   - Color mappings (sha_colors, role_colors)\n   - The draw_screen() method itself\n\n2. **Separate data layer from rendering** - Move the pipeline out of curses_main():\n   - build_row_values() \n   - compute_columns_and_widths()\n   - render_cell_text()\n   These are already well-structured but embedded in the main function.\n\n3. **Add regression test for table rendering** - Capture expected output for known input to prevent truncation bugs from recurring. Mock curses calls and verify character positions.","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:17:41.072469Z","created_by":"Andrew Erickson","updated_at":"2026-01-21T22:36:49.924878Z","closed_at":"2026-01-21T22:36:49.924878Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-azw","title":"Non-zero exit codes for JSON mode on failures","description":"In JSON output mode, commands currently return exit code 0 even when SSH fails. Ensure host-set-override and host-unset-override return non-zero on failure even when --json is used, and ensure host-audit returns non-zero when any host fails in batch mode (and when single-host audit fails). Update tests accordingly.","status":"closed","priority":2,"issue_type":"bug","owner":"aerickson@mozilla.com","created_at":"2026-01-21T00:58:59.503365Z","created_by":"Andrew Erickson","updated_at":"2026-01-21T06:20:28.029036Z","closed_at":"2026-01-21T06:20:28.029036Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-b01","title":"Add trap cleanup to remote shell scripts","description":"The remote scripts use 'set -eu' but intermediate failures leave unclear state. In ssh.py remote_set_script (lines 148-171):\n\n```shell\nsudo -n chmod $m \"$tmp\"   # If this fails...\nsudo -n chown $og \"$tmp\"  # ...this never runs, temp file orphaned\nsudo -n mv -f \"$tmp\" \"$op\" # ...and this never runs\n```\n\nIf chmod succeeds but chown fails, a temp file is left orphaned on the remote host.\n\nSolution: Add explicit trap for cleanup:\n```shell\ntrap 'sudo -n rm -f \"$tmp\" 2>/dev/null' EXIT\n```\n\nApply to all remote script generators in ssh.py.","status":"closed","priority":0,"issue_type":"bug","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:55.119574Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T04:56:27.049627Z","closed_at":"2026-01-29T04:56:27.049588Z","close_reason":"Completed: Added EXIT trap cleanup to remote_set_script() and remote_unset_script() with comprehensive tests","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-b0e","title":"Add Makefile for common dev commands","description":"Add a Makefile (or justfile) to standardize common development commands.\n\n## Commands to include\n- `make test` - Run pytest\n- `make lint` - Run ruff/mypy checks\n- `make watch` - Run pytest-watcher\n- `make install` - Install dependencies with uv sync\n- `make clean` - Remove __pycache__, .pytest_cache, etc.\n- `make coverage` - Run `uv run pytest --cov --cov-report html --cov-report term-missing`\n\n## Why\nReduces onboarding friction and provides consistent commands across environments. Quick win (~30 min).\n","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T23:04:13.388237Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T02:40:33.556990Z","closed_at":"2026-01-29T02:40:33.556951Z","close_reason":"Makefile exists with all requested commands","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-b65","title":"Add pre-commit hooks (mypy, ruff, bandit)","description":"No static analysis is currently configured for the project. This creates risk of type errors, style drift, and potential security issues going undetected.\n\n## What to add\n- **mypy**: Type checking (codebase already has full type hints)\n- **ruff**: Linting and formatting (replaces flake8, black, isort)\n- **bandit**: Security scanning for common Python vulnerabilities\n\n## Implementation\n1. Add .pre-commit-config.yaml with hooks for mypy, ruff, bandit\n2. Add pyproject.toml sections for mypy and ruff configuration\n3. Fix any issues surfaced by initial run\n4. Document in README how to install pre-commit hooks\n\n## Why P2\nType hints are already present but not validated. Adding mypy will catch real bugs. Ruff will prevent style drift as more contributors join.","status":"closed","priority":1,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:52:34.597453Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T02:40:31.124244Z","closed_at":"2026-01-29T02:40:31.124207Z","close_reason":"Pre-commit hooks already configured with ruff, ty, detect-secrets, shellcheck, actionlint","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-bns","title":"Document audit log JSON schema","description":"The audit log (JSONL format) has no formal schema documentation. Consumers must read the code to understand the structure.\n\n## Current state\n- Records written by process_audit_result() in fleetroll/audit.py\n- Fields include: ts, actor, action, host, override_path, role_path, ok, ssh_rc, stderr, observed{}\n- observed contains: role_present, role, override_present, override_meta{}, override_sha256, uptime_s\n\n## Deliverables\n1. JSON Schema file (audit-record.schema.json) formally defining the record structure\n2. Example records in documentation showing success/failure cases\n3. Field descriptions explaining semantics (e.g., what does ok=false mean?)\n4. Version field consideration for future schema evolution\n\n## Why P3\nNice to have for external tooling integration. Not blocking current work but improves maintainability and enables third-party consumers.","status":"open","priority":4,"issue_type":"chore","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:52:34.950414Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T07:14:18.999303Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-c29","title":"host-monitor: explore bar graph, age sorting, stale filter for LAST_OK","status":"open","priority":4,"issue_type":"feature","owner":"aerickson@mozilla.com","created_at":"2026-01-21T21:13:10.813797Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T07:14:09.092553Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-c29","depends_on_id":"mvp-5jc","type":"blocks","created_at":"2026-01-29T02:51:07.378914Z","created_by":"aerickson"}]}
{"id":"mvp-cx5","title":"Address security considerations","description":"Several security-related improvements needed:\n\n1. StrictHostKeyChecking=accept-new (line 171)\n   - Silently accepts new host keys, potential MITM risk\n   - Make configurable via --strict-host-key-checking flag\n   - Add warning when accept-new is used\n\n2. No size limit on content\n   - Large files could cause memory/performance issues\n   - Add --max-size flag (default: 1MB?)\n   - Fail gracefully with clear error if exceeded\n\n3. sudo -n assumption\n   - Code assumes passwordless sudo is configured\n   - Fail gracefully with clear message if sudo prompts for password\n   - Document this requirement in help text\n\n4. Consider adding --no-strict-host-key option for explicit opt-in to less secure mode","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:55.876066Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T23:01:09.789185Z","closed_at":"2026-01-16T23:01:09.789185Z","close_reason":"Deferred. Security considerations are minor for MVP scope. Can revisit if needed.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-cx5","depends_on_id":"mvp-fgd","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-dgz","title":"Extract MonitorDisplay into separate modules","description":"The monitor command (commands/monitor.py) is 990 lines handling two distinct concerns that should be separated:\n\n## Current State\n- Single 990-line file mixing data and UI logic\n- Data layer: Log parsing, host state aggregation, filtering\n- UI layer: Curses rendering, input handling, screen layout\n\n## Proposed Structure\n```\nfleetroll/commands/monitor/\n├── __init__.py      # Public exports, cmd_host_monitor entry point\n├── state.py         # HostState, log parsing, aggregation (testable)\n├── display.py       # MonitorDisplay curses class (harder to test)\n└── types.py         # Shared types/dataclasses\n```\n\n## Benefits\n- Data layer becomes easily unit testable without curses mocking\n- Clear separation of concerns\n- Easier to add new display modes (e.g., non-curses JSON streaming)\n- Reduces cognitive load when working on either layer\n\n## Dependencies\nShould be done AFTER:\n- mvp-31n (monitor test coverage) - tests provide safety net for refactor\n- mvp-5jc (refactor draw_screen) - reduces scope of this change","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T23:06:09.390083Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T04:39:56.614847Z","closed_at":"2026-01-29T04:39:56.614814Z","close_reason":"Completed: Successfully extracted MonitorDisplay into separate modules with clear separation of concerns (types, data, formatting, display, entry)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-dgz","depends_on_id":"mvp-31n","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"},{"issue_id":"mvp-dgz","depends_on_id":"mvp-5jc","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-dov","title":"host-monitor display modes","description":"Add selectable display modes (e.g., all, compact) in host-monitor mode so users can switch views while monitoring.","status":"open","priority":4,"issue_type":"feature","owner":"aerickson@mozilla.com","created_at":"2026-01-27T01:36:30.539340Z","created_by":"Andrew Erickson","updated_at":"2026-02-04T04:51:49.949659Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-dov","depends_on_id":"mvp-5jc","type":"blocks","created_at":"2026-01-29T02:51:09.498348Z","created_by":"aerickson"}]}
{"id":"mvp-esc","title":"Extract generic retry logic","description":"The retry pattern in audit_single_host_with_retry (commands/audit.py:34-118) is useful but tightly coupled to the audit use case.\n\nExtract into a reusable utility:\n```python\ndef with_retry(\n    fn: Callable[[], T],\n    *,\n    max_retries: int = 3,\n    backoff_base: float = 2.0,\n    is_retryable: Callable[[Exception], bool],\n) -> T:\n    \"\"\"Generic retry wrapper with exponential backoff.\"\"\"\n```\n\nThis would allow reuse for set/unset commands if batch mode is added later.","status":"open","priority":4,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:55.723363Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T04:20:19.704951Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-esc","depends_on_id":"mvp-vc5","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-f46","title":"Add horizontal scrolling to host-monitor display","description":"Add horizontal scrolling capability to the host-monitor display to accommodate additional columns without losing data.\n\n## Current Problem\n\nThe monitor currently drops columns when terminal width is too narrow:\n- Drop order: vlt_sha → sha → role → ts → uptime → err\n- This hides important information on narrow terminals\n\n## Proposed Solution\n\nAdd horizontal scrolling with left/right arrow keys:\n- HOST column: Frozen on the left (always visible)\n- Other columns: Scroll horizontally with ← → arrow keys\n- Up/Down arrows: Continue to navigate rows (existing behavior)\n- PgUp/PgDn/Home/End: Continue to work for vertical navigation\n\n## Column Layout\n\n[HOST (frozen)] | [scrollable: STAT | ERR | ROLE | OVR_SHA | VLT_SHA | UPTIME | LAST_OK | TC_QUAR | TC_LAST | TC_START | TC_RESV]\n\n## Implementation Details\n\n1. Track horizontal scroll offset (col_offset)\n2. Always render HOST column at position 0\n3. Render visible subset of remaining columns based on:\n   - Available terminal width minus HOST column width\n   - Current horizontal scroll offset\n4. Add key handlers:\n   - KEY_LEFT: Decrease col_offset (if > 0)\n   - KEY_RIGHT: Increase col_offset (if more columns exist)\n5. Show scroll indicator in footer:\n   - \"← Columns 2-6 of 11 →\" (when scrolled)\n   - Or visual indicator like \"◀ ▶\" when more columns available\n\n## Benefits\n\n- No data loss on narrow terminals\n- Supports adding new columns (e.g., TaskCluster data) without layout constraints\n- Better UX for users with narrow terminals or many columns\n\n## Testing Considerations\n\n- Test with various terminal widths (80, 120, 160 columns)\n- Test with long hostnames that exceed HOST column width\n- Verify frozen column behavior\n- Test edge cases (scroll to beginning/end)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-27T05:50:08.534102Z","created_by":"aerickson","updated_at":"2026-01-27T06:57:04.626827Z","closed_at":"2026-01-27T06:57:04.626792Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-fgd","title":"Split fleetroll_mvp.py into modules","description":"Refactor the 1000+ line single file into a proper package structure:\n\nfleetroll/\n├── __init__.py\n├── cli.py           # Argument parsing\n├── ssh.py           # run_ssh, remote script generation\n├── audit.py         # Logging, store_override_file\n├── commands/\n│   ├── audit.py\n│   ├── set.py\n│   └── unset.py\n└── utils.py         # utc_now_iso, sha256_hex, etc.\n\nThis improves maintainability, testability, and makes the codebase easier to navigate.","status":"closed","priority":1,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:54.369429Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:43:19.508351Z","closed_at":"2026-01-16T22:43:19.508351Z","close_reason":"Split fleetroll_mvp.py into modular package: exceptions.py, constants.py, utils.py, ssh.py, audit.py, cli.py, commands/{audit,set,unset}.py","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-fgd","depends_on_id":"mvp-83l","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"},{"issue_id":"mvp-fgd","depends_on_id":"mvp-xkv","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-fx7","title":"Remote host: cap override backup files","description":"On remote host, ensure there aren't too many override backup files (audit + cleanup/limit as needed).","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-26T23:43:55.325655Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T06:46:16.531322Z","closed_at":"2026-01-29T06:46:16.531291Z","close_reason":"Completed: Added content deduplication (skip backup if identical) and automatic cleanup of old backups (keep 30 most recent). Backups only created when content actually changes, preserving mtime for accurate 'applied' status. Cleanup runs on every set/unset operation.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-g88","title":"Introduce Result dataclasses for command outputs","description":"Command functions currently return untyped dicts/tuples. Introduce typed dataclasses for better IDE support and self-documenting code.\n\n## Current Pattern\n```python\n# Returns dict with implicit schema\nresult = {'host': h, 'ok': True, 'role': r, 'override_sha': sha}\n```\n\n## Proposed Pattern\n```python\n@dataclass(frozen=True)\nclass AuditResult:\n    host: str\n    success: bool\n    role_present: bool\n    override_present: bool\n    override_sha: Optional[str] = None\n    error: Optional[str] = None\n    \n@dataclass(frozen=True)\nclass SetResult:\n    host: str\n    success: bool\n    previous_sha: Optional[str] = None\n    new_sha: Optional[str] = None\n    error: Optional[str] = None\n```\n\n## Result Types to Add\n- AuditResult - for host-audit command\n- SetResult - for host-set-override command\n- UnsetResult - for host-unset-override command\n- HostState - for monitor (may already exist partially)\n\n## Benefits\n- IDE autocomplete and type checking\n- Self-documenting return values\n- Easier refactoring (rename detection)\n- Immutable by default (frozen=True)\n\n## Location\nNew file: `fleetroll/results.py` or inline in each command module","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T23:06:09.590383Z","created_by":"Andrew Erickson","updated_at":"2026-02-04T04:55:05.332422Z","closed_at":"2026-02-04T04:55:05.332377Z","close_reason":"TypedDict or return type hints provide sufficient type checking without adding dataclass overhead. Can recreate if genuine pain emerges.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-hmg","title":"Display taskcluster success rate in host-monitor mode","description":"In host-monitor mode, display the taskcluster success rate for each worker. Requires the success rate data collection to be implemented first.","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T22:43:57.406482Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T05:49:09.652410Z","closed_at":"2026-01-27T05:49:09.652331Z","close_reason":"Superseded by new TaskCluster display strategy with horizontal scrolling","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-hmg","depends_on_id":"mvp-6h3","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-iea","title":"Implement tc-fetch command for TaskCluster worker data collection","description":"Add a new command to fetch TaskCluster worker data for specified hosts.\n\n## Command Interface\n\nfleetroll tc-fetch <host-or-file>\n\nAccepts single hostname or file with host list (like host-audit).\n\n## Implementation Steps\n\n1. Parse host list: Use existing host-or-file parsing logic\n2. Find roles: For each host, find most recent audit record (any action) and extract role from observed.role\n3. Map roles to workerTypes: Use hardcoded lookup table:\n   ROLE_TO_TASKCLUSTER = {\n       \"gecko_t_linux_talos\": (\"releng-hardware\", \"gecko-t-linux-talos-1804\"),\n       \"gecko_t_linux_2404_talos\": (\"releng-hardware\", \"gecko-t-linux-talos-2404\"),\n   }\n4. Fetch GraphQL data: For each unique workerType, query TaskCluster GraphQL API:\n   - URL: https://firefox-ci-tc.services.mozilla.com/graphql\n   - Query: ViewWorkers operation\n   - Batch by workerType to minimize API calls\n5. Match workers to hosts: Strip FQDN from hostname (e.g., t-linux64-ms-016.test.releng.mdc1.mozilla.com → t-linux64-ms-016) and match against workerId\n6. Store results: Write to .fleetroll/taskcluster_workers.jsonl\n\n## GraphQL Query\n\nUse the ViewWorkers query, simplified to fetch only needed fields:\n- workerId\n- state\n- lastDateActive\n- latestTask.run.started\n- latestTask.run.resolved\n- quarantineUntil\n\n## JSONL Format\n\nTwo record types:\n\nWorker record (one per matched host):\n{\n  \"type\": \"worker\",\n  \"ts\": \"2026-01-27T04:30:00Z\",\n  \"host\": \"t-linux64-ms-280.test.releng.mdc1.mozilla.com\",\n  \"worker_id\": \"t-linux64-ms-280\",\n  \"provisioner\": \"releng-hardware\",\n  \"worker_type\": \"gecko-t-linux-talos-2404\",\n  \"state\": \"running\",\n  \"last_date_active\": \"2026-01-27T04:25:00Z\",\n  \"task_started\": \"2026-01-27T04:20:00Z\",\n  \"task_resolved\": \"2026-01-27T04:24:00Z\",\n  \"quarantine_until\": null\n}\n\nScan record (one per workerType checked):\n{\n  \"type\": \"scan\",\n  \"ts\": \"2026-01-27T04:30:00Z\",\n  \"provisioner\": \"releng-hardware\",\n  \"worker_type\": \"gecko-t-linux-talos-2404\",\n  \"worker_count\": 15,\n  \"requested_by_hosts\": [\"t-linux64-ms-280.test.releng.mdc1.mozilla.com\"]\n}\n\n## Error Handling\n\n- If host has no audit record: Display \"-\" (no data) in output\n- If role not in lookup table: Warn user, skip that host\n- Fetch all workerTypes even if some hosts might not be found in TC data\n\n## Output\n\nShow summary of fetched data:\nFetching TaskCluster data for 5 hosts...\nFound roles: gecko_t_linux_talos (3 hosts), gecko_t_linux_2404_talos (2 hosts)\nQuerying workerType releng-hardware/gecko-t-linux-talos-1804... 3 workers found\nQuerying workerType releng-hardware/gecko-t-linux-talos-2404... 2 workers found\nWrote 5 worker records and 2 scan records to .fleetroll/taskcluster_workers.jsonl","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-27T05:49:53.699286Z","created_by":"aerickson","updated_at":"2026-01-27T06:50:22.066036Z","closed_at":"2026-01-27T06:50:22.066007Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-iyp","title":"host-monitor: hide OVR/MTIME, rename SHA","description":"In host-monitor mode, hide OVR and MTIME columns and rename SHA column to OVR_SHA.","status":"closed","priority":2,"issue_type":"feature","owner":"aerickson@mozilla.com","created_at":"2026-01-27T01:38:47.876958Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T03:06:27.736296Z","closed_at":"2026-01-27T03:06:27.736296Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-k5e","title":"Confirm before setting/unsetting override when no --confirm flag","description":"When setting or unsetting an override, if the --confirm flag is not provided, prompt the user with a confirmation showing what will happen (e.g., number of hosts and, for set, the override to be applied).","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-26T23:38:52.520499Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T00:10:49.052760Z","closed_at":"2026-01-27T00:10:49.052760Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-l0h","title":"Add structured logging with structlog","description":"Current debug logging uses unstructured string formatting. Structured logging would improve production debugging and observability.\n\n## Current State\n```python\nlogger.debug(f'Auditing host {host}, timeout={timeout}')\n```\n\n## Proposed Pattern\n```python\nimport structlog\nlogger = structlog.get_logger()\n\nlogger.info('audit_started', host=host, timeout=timeout)\nlogger.info('audit_complete', host=host, duration_ms=elapsed, success=True)\nlogger.warning('ssh_retry', host=host, attempt=2, error=str(e))\n```\n\n## Benefits\n- Machine-parseable logs (JSON output option)\n- Consistent field names across log entries\n- Easy integration with log aggregation (ELK, Datadog, etc.)\n- Context binding (add request_id, actor to all logs in a session)\n\n## Implementation\n1. Add structlog to dependencies\n2. Configure processors (JSON for prod, console for dev)\n3. Replace logger.debug/info calls with structured equivalents\n4. Add context binding for actor, session_id\n\n## Priority\nP4 - Nice to have for production deployment, not blocking MVP functionality. Current logging is adequate for development.","status":"open","priority":4,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-21T23:06:09.775593Z","created_by":"Andrew Erickson","updated_at":"2026-01-21T23:06:09.775593Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-lpb","title":"Add --dry-run mode for set/unset commands","description":"For host-set-override and host-unset-override, add a --dry-run flag that shows what would happen without making changes.\n\nImplementation:\n- Add --dry-run flag to both commands\n- When enabled, audit the current state\n- Show proposed changes (for set: new content hash, permissions; for unset: what would be removed)\n- Skip the actual SSH write/delete operation\n- Still log to audit as action: 'host.set_override.dry_run' or similar\n\nExample output:\n  $ fleetroll host-set-override myhost --from-file new.conf --dry-run --confirm\n  [DRY RUN] Would write to /etc/puppet/ronin_settings on myhost\n  Current: sha256=abc123... (exists)\n  Proposed: sha256=def456... (from new.conf)\n  Mode: 0644, Owner: root:root","status":"closed","priority":2,"issue_type":"feature","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:55.438573Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T23:00:08.755813Z","closed_at":"2026-01-16T23:00:08.755813Z","close_reason":"Unnecessary. Users can host-audit first to see current state, then use --confirm to execute. Adding --dry-run would duplicate host-audit functionality.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-lpb","depends_on_id":"mvp-olh","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-olh","title":"Migrate from argparse to Click CLI framework","description":"The code currently mixes argparse and click (click is only used for progress bar). Migrate fully to Click for:\n\n- Better subcommand handling\n- Auto-generated help text\n- Consistent CLI patterns\n- Type validation built-in\n- Already a dependency\n\nExample structure:\n@click.group()\n@click.option('--json', is_flag=True)\ndef cli(json):\n    pass\n\n@cli.command()\n@click.argument('host')\ndef host_audit(host):\n    ...","status":"closed","priority":2,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:54.574890Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:50:16.130243Z","closed_at":"2026-01-16T22:50:16.130243Z","close_reason":"Migrated from argparse to Click. Added version option, improved help text with show_default, cleaner decorator-based CLI structure.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-olh","depends_on_id":"mvp-fgd","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-r7k","title":"Investigate extended terminal colors (256 vs 16)","description":"Investigate using extended terminal color support for better visual distinction in the monitor display.\n\n## Current State\n\nCurrently using 16 basic colors (COLOR_CYAN, COLOR_YELLOW, etc.) with doubled palette via A_REVERSE attribute. This limits visual design options.\n\n## Investigation Areas\n\n1. **256-color support**\n   - Most modern terminals support 256 colors\n   - Provides better gradations and more distinct colors\n   - Can use color palette indices 0-255\n\n2. **Detection**\n   - Check TERM environment variable (xterm-256color, screen-256color, etc.)\n   - Query curses.COLORS to see available color count\n   - Graceful fallback to 16-color mode for older terminals\n\n3. **Use cases**\n   - More distinct role colors (currently cycling through limited palette)\n   - Better status indication gradients (fresh → stale)\n   - Improved help popup styling\n\n## Implementation Considerations\n\n- Use curses.COLORS to detect capability\n- Define color schemes for both 16-color and 256-color modes\n- Test on common terminal emulators (iTerm2, Terminal.app, tmux, screen)\n\n## References\n\n- curses.init_pair() supports color indices 0-255 when COLORS >= 256\n- Standard 256-color palette: 0-15 (basic), 16-231 (216-color cube), 232-255 (grayscale)","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-28T09:46:33.104943Z","created_by":"aerickson","updated_at":"2026-01-29T11:37:41.796578Z","closed_at":"2026-01-29T11:37:41.796547Z","close_reason":"Implemented 256-color support with 8 distinct extended colors (orange, purple, pink, teal, maroon, gold, forest-green, orange-red). Combined with standard 7 colors gives 15 total (30 with reverse) - more than enough for 22 SHA values. Tested and working.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-r90","title":"Fix concurrent audit log writes (JSONL corruption)","status":"closed","priority":2,"issue_type":"bug","owner":"aerickson@mozilla.com","created_at":"2026-01-21T00:37:11.494389Z","created_by":"Andrew Erickson","updated_at":"2026-01-21T00:48:48.726805Z","closed_at":"2026-01-21T00:48:48.726805Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-sl3","title":"Centralize configuration constants","description":"Hardcoded values are scattered across files:\n- max_retries = 3 (commands/audit.py:47)\n- retry_delay = 2 (commands/audit.py:48)\n- prefix_len = 12 (audit.py:35)\n\nThese should be centralized, either:\n1. Extend constants.py with these values\n2. Create a Config dataclass that can be overridden\n\nThis improves maintainability and makes behavior easier to tune.","status":"closed","priority":4,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:55.926351Z","created_by":"Andrew Erickson","updated_at":"2026-01-27T03:35:54.149172Z","closed_at":"2026-01-27T03:35:54.149172Z","close_reason":"Completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-u0c","title":"Make type checking blocking in CI workflow","description":"Remove `continue-on-error: true` from the type checking job in .github/workflows/ci.yml once the Args bag pattern is refactored. Currently ty reports 261 type warnings because Args uses dynamic attribute access that can't be type-checked. This should be done after the Args refactoring task is complete.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T20:07:56.975518Z","created_by":"aerickson","updated_at":"2026-01-29T09:47:21.724336Z","closed_at":"2026-01-29T09:47:21.724298Z","close_reason":"Type checking is now blocking in CI. Fixed 8 critical type errors, suppressed 2 false positives with type: ignore comments. 35 warnings remain (mostly curses/progressbar - acceptable).","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-u0c","depends_on_id":"mvp-vsw","type":"blocks","created_at":"2026-01-28T20:08:08.524789Z","created_by":"aerickson"}]}
{"id":"mvp-uvz","title":"Create JSON state writing function","description":"Create a reusable bash function that writes puppet run state to /etc/puppet/last_run_metadata.json. Must handle both Linux (sha256sum) and macOS (shasum), capture git info, calculate SHAs, use atomic writes, and never fail puppet run.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T21:41:14.764340Z","created_by":"aerickson","updated_at":"2026-01-29T21:55:47.806028Z","closed_at":"2026-01-29T21:55:47.805992Z","close_reason":"Completed: Created write_puppet_state.sh function with configurable output path, cross-platform SHA support, git info extraction, atomic writes, and robust error handling","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-uvz","depends_on_id":"mvp-3kp","type":"parent-child","created_at":"2026-01-29T21:41:14.765738Z","created_by":"aerickson"}]}
{"id":"mvp-vc5","title":"Add test suite with pytest","description":"The codebase has zero tests. For a tool that remotely modifies files across a fleet, this is unacceptable risk. Regressions in SSH script generation or result parsing could cause fleet-wide incidents.\n\nTests should cover:\n- Remote script generation (verify shell syntax, quoting)\n- Result parsing (parse_kv_lines, content extraction)\n- CLI argument validation\n- Error handling paths\n\nConsider using pytest fixtures for mocking SSH execution.","status":"closed","priority":1,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:54.692313Z","created_by":"Andrew Erickson","updated_at":"2026-01-17T00:14:16.840883Z","closed_at":"2026-01-17T00:14:16.840883Z","close_reason":"Added comprehensive pytest test suite with 140 tests covering utils, SSH scripts, audit logging, commands, CLI, and retry logic","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-vsw","title":"Replace Args bag with typed dataclasses","description":"The Args class (cli.py:44-49) is a dynamic attribute bag that discards type information:\n\n```python\nclass Args:\n    def __init__(self, **kwargs):\n        for key, value in kwargs.items():\n            setattr(self, key, value)\n```\n\nImpact: No IDE completion, runtime AttributeError possible, unclear contracts between CLI and command functions.\n\nSolution: Create typed definitions for each command's arguments.\n\n**Option 1: TypedDict** (recommended)\nLightweight, good type checking, standard library. Args objects are created once and passed to commands, so mutability isn't a concern in practice.\n\n**Option 2: Dataclasses with frozen=True**\nIf enforcing immutability is desired, though adds boilerplate overhead.\n\nCommands needing typed args:\n- HostAuditArgs\n- HostMonitorArgs  \n- OverrideShowArgs\n- VaultShowArgs\n- HostSetOverrideArgs\n- HostSetVaultArgs\n- HostUnsetOverrideArgs\n- TcFetchArgs","status":"closed","priority":1,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T23:57:54.898670Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T05:39:53.205927Z","closed_at":"2026-01-29T05:39:53.205892Z","close_reason":"Completed: Replaced Args bag with typed dataclasses","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"mvp-vsw","depends_on_id":"mvp-vc5","type":"blocks","created_at":"2026-01-28T19:21:06Z","created_by":"import"}]}
{"id":"mvp-w5h","title":"Config file support for common CLI settings","description":"Add config file support for common settings (e.g., ssh-timeout, fqdn postfix) so users don't need to specify them on every run.","status":"open","priority":4,"issue_type":"feature","owner":"aerickson@mozilla.com","created_at":"2026-01-27T01:45:08.065930Z","created_by":"Andrew Erickson","updated_at":"2026-01-29T06:30:20.225113Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"mvp-xkv","title":"Extract magic strings to module-level constants","description":"Several magic strings are embedded inline throughout the code. Extract to constants at module level for maintainability:\n\n# Constants\nCONTENT_SENTINEL = \"__FLEETROLL_OVERRIDE_CONTENT__\"\nBACKUP_TIME_FORMAT = \"%Y%m%dT%H%M%SZ\"\nDEFAULT_OVERRIDE_PATH = \"/etc/puppet/ronin_settings\"  # already exists\nDEFAULT_ROLE_PATH = \"/etc/puppet_role\"  # already exists\nDEFAULT_AUDIT_SUBDIR = \".fleetroll\"\nDEFAULT_AUDIT_FILENAME = \"audit.jsonl\"\nDEFAULT_OVERRIDES_SUBDIR = \"overrides\"\nSSH_TIMEOUT_EXIT_CODE = 124\n\nThis makes the code more maintainable and easier to modify behavior.","status":"closed","priority":3,"issue_type":"task","owner":"aerickson@mozilla.com","created_at":"2026-01-16T22:26:55.652334Z","created_by":"Andrew Erickson","updated_at":"2026-01-16T22:36:09.320868Z","closed_at":"2026-01-16T22:36:09.320868Z","close_reason":"Extracted 6 constants: CONTENT_SENTINEL, BACKUP_TIME_FORMAT, SSH_TIMEOUT_EXIT_CODE, AUDIT_DIR_NAME, AUDIT_FILE_NAME, OVERRIDES_DIR_NAME","source_repo":".","compaction_level":0,"original_size":0}
